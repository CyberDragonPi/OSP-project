---
title: "Projekt - Settlers of Catan stats"
author: "36544062 Marko Pongrac, 36540794 Marko Kukolj"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
```

## 0. MOTIVACIJA I UVOD

<p>Kao ljubitelji društvene igre Catan te osobe koje ne vole gubiti, autori ovog rada izabrali su ovu temu s ciljem pronalaženja informacija, kako bi poboljšali svoju strategiju te šansu za pobjedu prilikom igranja s prijateljima. Zbog toga, ali i nekih iskustvenih pojava, ovaj rad pokušava dati odgovor na sljedeća pitanja:</p>
<ol start="1" style="margin-left: 5em;">
  <li>Je li kocka zaista poštena?</li>
  <li>Postoji li neka kombinacija resurs(a) na početnim susjednim poljima koja povećava vjerojatnost pobjede?</li>
  <li>Postoji li neka kombinacija broj(eva) na početnim susjednim poljima koja povećava vjerojatnost pobjede?</li>
  <li>Utječe li redoslijed postavljanja naselja na pobjednika?</li>
</ol>

```{r}
getwd()
source("../R/CatanDataLoading.R")
```


\newpage
## 1. Je li kocka poštena?
<p>
Svima se sigurno dogodila partija u kojoj su naselja lukavo postavili na poziciju susjednu poljima s brojevima koji bi teoretski trebali češće padati, međutim magično su se brojevi 3 i 12 pojavljivali češće nego 8 i 9. Budući da se i njima samima dogodila takva partija, autori rada odlučili su prvo istražiti je li kocka poštena. Odnosno, pojavljuje li se zaista broj 7 najčešće, malo rjeđe brojevi 6 i 8, i tako do bojeva 2 i 12, koji bi se najređe trebali pojavljivati. Budući da imamo prilično velik uzorak bacanja, distribucija brojeva bi trebala biti slična normalnoj.
</p>
```{r, message = FALSE}
source("../R/CatanAnalyseMatchData.R")
mean_frequency <- mean(frequency_df$number_frequency)
sd_frequency <- sd(frequency_df$number_frequency)

dice_frequency_plot <- ggplot(frequency_df, aes(x = number, y = number_frequency)) + 
  geom_bar(fill = "red", stat = "identity") +
  geom_text(aes(x = number, y = 0, label = number), stat = "identity", vjust = -1, size = 3) + 
  geom_smooth(method)
dice_frequency_plot %>% print()
```



\newpage
## 2. Utjecaj početka igre na pobjedu

<p>
Najbitnija stvar u igri Catan je kao i u svakoj društvenoj igri pobjediti, pa ćemo nakon prethodne, očito pogrešne, analize da je kocka poštena (svatko tko je igrao bilo kakvu društvenu igru zna da kocka nikako nije poštena) pokušati otkriti kako pobijediti. Prvo ćemo razmatrati kako početak igre utječe na izglede pobjede. Pokušati ćemo odgovoriti na dva pitanja u ovom dijelu:
</p>
<ol start="1" style="margin-left: 5em;">
  <li>
  Utječu li, i ako da kako, početni resursi na vjerojatnost pobjede?
  </li>
  <li>
  Utječu li, i ako da kako, brojevi na poljima oko našeg početnog settlementa na vjerojatnos pobjede?
  </li>
</ol>

## 2.1. Utjecaj početnih resursa na pobjedu

<p>
Prije početka legenda resursa:
</p>
<ol start="1" style="margin-left: 5em;">
<li>
L = lumber (hrv. drvo)
</li>
<li>
C = clay (hrv. cigla)
</li>
<li>
S = sheep (hrv. ovca)
</li>
<li>
W = wheat (hrv. žito)
</li>
<li>
O = ore (hrv. kamen)
</li>
<li>
3G = 3:1 general port (hrv. luka)
</li>
<li>
2(X) = 2:1 port for resource X (hrv. luka za resurs X)
</li>
<li>
D = desert (hrv. pustinja)
</li>
<li>
B = blank (moguće je postaviti settlement da graniči s 2 polja, umjesto 3)
</li>
</ol>
<p>
*Translator note: nazivi nisu doslovno prevedeni te vjerojatno svi imaju načine kako zovu polja u svojim igrama. Korišten je prijevod koji autori koriste kad igraju ovu igru.
</p>

```{r}
source("../R/AnalyseStartingResources.R")
ggplot() +
  geom_col(aes(x = names(starting_resources_table),
               y = starting_resources_table,
               fill = "Non-winners"),
           alpha = 0.5, position = "dodge") +
  geom_col(aes(x = names(starting_resources_winners_table),
               y = starting_resources_winners_table,
               fill = "Winners"),
           alpha = 0.5, position = "dodge") +
  scale_fill_manual(name = "Legend",
                    breaks = c("Non-winners", "Winners"),
                    values = c("Non-winners" = "#0827F5", "Winners" = "#AB2328")) +
  labs(title = "Starting resources occurances", x = "Resource", y = "Percantage")
```

<p>
Iz grafa je evidentno da svi igrači imaju prilično sličnu viziju kako igrati Catan. Pobjednici cijene ovce(S na grafu) kao resurs više od ostalih igrača, no osim toga čini se da igrači stavljaju vrlo slične vrijednosti na resurse.
</p>
<h2>
Zaključak
</h2>
<p>
Čini se da pšenica i ovcu imaju najveću vrijednost pri postavljanju početna 2 naselja, nakon čega slijedi drvo te veliku vrijednost, no manju od prethodna 3 resursa, imaju i kamen i cigla. Luke imaju izuzetno malu vrijednost, te pobjednici jedino stavljaju bitno veći prioritet na ovce od ostalih igrača (čak nevjerojatnih 2.5% više pobjednika u prva dva naselja osigura pristup ovcama u odnosu na ostale igrače), tako da je možda pametno osigurati pristup ovcama na početku igre.
</p>

\newpage
## 2.2 Utjecaj početnih brojeva na pobjedu

<p>
Nakon razočaravajućeg rezultata da početni resursi ne čine bitno razliku u određivanju pobjednika okrećemo se brojevima u našem nastojanju da maksimiziramo svoje šanse pobjede već na početku igre.
</p>

```{r}
source("../R/AnalyseStartingNumbers.R")
ggplot() +
  geom_col(aes(x = fct_reorder(names(starting_numbers_table),
                               as.numeric(names(starting_numbers_table))),
               y = starting_numbers_table,
               fill = "Non-winners"),
           alpha = 0.5, position = "dodge") +
  geom_col(aes(x = fct_reorder(names(starting_numbers_winners_table),
                               as.numeric(names(starting_numbers_winners_table))),
               y = starting_numbers_winners_table,
               fill = "Winners"),
           alpha = 0.5, position = "dodge") +
  scale_fill_manual(name = "Legend",
                    breaks = c("Non-winners", "Winners"),
                    values = c("Non-winners" = "#0827F5", "Winners" = "#AB2328")) +
labs(title = "Starting numbers occurances", x = "Numbers", y = "Percantage")
```

<p>
Za razliku od prethodne analize vidimo da postoji bitnija razlika u biranju brojeva na početnim poljima između pobjednika i ostalih igrača. Pobjednici češće biraju brojeve u intervalu [5, 10], dok ostali igrači češće biraju preostale brojeve.
</p>

<h2>
Zaključak
</h2>
<p>
Čini se da je puno bitnije odabrati polja koja imaju "dobre" brojeve (brojeve koji imaju veću vjerojatnost da padnu) na početku igre, nego fokusirati se na resurse, tako da sljedeći put kad igrate dobro razmislite kako postaviti svoja naselja tako da maksimizirate vjerojatnost da dobijete nešto u svakom bacanju. Ovakav rezultat ide u prilog rezultatu da je kocka poštena, iako mislim da se svi iskustveno možemo složiti da je kocka sve osim poštena.
</p>

## 3. Tradeanje (naslov WIP)

\newpage
## 4. Redoslijed postavljanja naselja (naslov WIP)

\newpage
## 5. Predikcija

<p>
U svrhu pobjeđivanje pokušati ćemo zaključiti imaju li dobitci i gubljenje resursa značajnu vezu s pobjeđivanje. Iz tog razloga stvaramo linearan model koji će predviđati broj bodova na temelju svih mogućih dobitaka i gubitaka resursa.
</p>

```{r}
source("../R/Model.R")
summary(linMod)
```

<h2>
Zaključak
</h2>
<p>
Rezultati koje nam daje linearan model su vrlo loši, predviđa bodove s vrijednosti +-3, s tim da 50% predikcija ima grešku +-1. S obzirom da igrač pobjeđuje u Catanu kada skupi 10 ili više bodova, a sve u igri pridonosi 1 ili 2 boda, ovakva greška je vrlo velika i zaključujemo da linearan model nije dobar za predviđanje bodova u igri Catan. To je konzistentno s rezultatima na kaggleu na ovom datasetu gdje linearni modeli daju loše rezultate, no ljudi su imali više uspjeha s logističkom regresijom gdje binarno klasificiraju rezultat kao pobjedu ili gubitak te su neki postigli preciznost ~80%.
</p>

\newpage
## Zaključak
TODO lorem ipsum 
